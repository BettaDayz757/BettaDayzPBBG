#!/usr/bin/expect -f

set timeout 30

puts "ğŸš€ Deploying BettaDayz PBBG to Production Server"
puts "==============================================="

# Upload deployment package
puts "ğŸ“¤ Uploading deployment package..."
spawn scp -P 65002 -o StrictHostKeyChecking=no bettadayz-deployment-final.tar.gz u933155252@194.195.84.72:~/

expect {
    "password:" {
        send "@Jgallow20\r"
        exp_continue
    }
    "100%" {
        puts "âœ… Upload successful!"
    }
    timeout {
        puts "âŒ Upload timeout"
        exit 1
    }
}

# Connect to server and setup
puts "ğŸ”§ Setting up application on server..."
spawn ssh -p 65002 -o StrictHostKeyChecking=no u933155252@194.195.84.72

expect "password:"
send "@Jgallow20\r"

expect "$ " {
    send "echo 'ğŸ“‚ Setting up BettaDayz PBBG...'\r"
}

expect "$ " {
    send "mkdir -p ~/bettadayz\r"
}

expect "$ " {
    send "cd ~/bettadayz\r"
}

expect "$ " {
    send "tar -xzf ~/bettadayz-deployment-final.tar.gz\r"
}

expect "$ " {
    send "rm ~/bettadayz-deployment-final.tar.gz\r"
}

expect "$ " {
    send "ls -la\r"
}

expect "$ " {
    send "npm ci --only=production\r"
}

expect "$ " {
    send "cp .env.example .env.production\r"
}

expect "$ " {
    send "echo 'ğŸ‰ Deployment Complete! Edit .env.production and run: npm start'\r"
}

expect "$ " {
    send "exit\r"
}

expect eof

puts ""
puts "ğŸ‰ BettaDayz PBBG Deployment Complete!"
puts "====================================="
puts ""
puts "ğŸ”— To start the application:"
puts "   ssh -p 65002 u933155252@194.195.84.72"
puts "   cd ~/bettadayz"
puts "   npm start"
puts ""
puts "ğŸŒ Your application will be ready for both domains:"
puts "   https://bettadayz.shop"
puts "   https://bettadayz.store"