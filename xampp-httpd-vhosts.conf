# Apache Virtual Hosts Configuration for BettaDayz PBBG
# Location: d:\bettadayzweb\xampp\apache\conf\extra\httpd-vhosts.conf
#
# This file configures Apache to serve BettaDayz PBBG on local domains:
# - bettadayz.shop (primary domain)
# - bettadayz.store (secondary domain)
#
# Instructions:
# 1. Copy this file to: d:\bettadayzweb\xampp\apache\conf\extra\httpd-vhosts.conf
# 2. Edit d:\bettadayzweb\xampp\apache\conf\httpd.conf and uncomment:
#    Include conf/extra/httpd-vhosts.conf
# 3. Edit C:\Windows\System32\drivers\etc\hosts and add:
#    127.0.0.1  bettadayz.shop
#    127.0.0.1  www.bettadayz.shop
#    127.0.0.1  bettadayz.store
#    127.0.0.1  www.bettadayz.store
# 4. Restart Apache in XAMPP Control Panel

##
# Virtual Hosts Configuration
##

# Default localhost virtual host (fallback)
<VirtualHost *:80>
    ServerName localhost
    DocumentRoot "d:/bettadayzweb/xampp/htdocs"
    
    <Directory "d:/bettadayzweb/xampp/htdocs">
        Options Indexes FollowSymLinks Includes ExecCGI
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>

# ============================================================================
# PRIMARY DOMAIN: bettadayz.shop
# ============================================================================

# Main domain (non-www)
<VirtualHost *:80>
    ServerName bettadayz.shop
    ServerAdmin admin@bettadayz.shop
    
    # Proxy to Node.js application running on port 3000
    ProxyPreserveHost On
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
    
    # Enable WebSocket support for hot reload
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*)           ws://localhost:3000/$1 [P,L]
    RewriteCond %{HTTP:Upgrade} !=websocket [NC]
    RewriteRule /(.*)           http://localhost:3000/$1 [P,L]
    
    # Logging
    ErrorLog "logs/bettadayz-shop-error.log"
    CustomLog "logs/bettadayz-shop-access.log" common
    
    # Security headers
    Header always set X-Frame-Options "DENY"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "origin-when-cross-origin"
    
    # CORS headers for dual domain support
    Header always set Access-Control-Allow-Origin "http://bettadayz.shop, http://bettadayz.store"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
</VirtualHost>

# WWW subdomain redirect to non-www
<VirtualHost *:80>
    ServerName www.bettadayz.shop
    ServerAdmin admin@bettadayz.shop
    
    # Redirect all www traffic to non-www
    RewriteEngine On
    RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
    RewriteRule ^(.*)$ http://%1$1 [R=301,L]
    
    ErrorLog "logs/www-bettadayz-shop-error.log"
    CustomLog "logs/www-bettadayz-shop-access.log" common
</VirtualHost>

# ============================================================================
# SECONDARY DOMAIN: bettadayz.store
# ============================================================================

# Main domain (non-www)
<VirtualHost *:80>
    ServerName bettadayz.store
    ServerAdmin admin@bettadayz.store
    
    # Proxy to Node.js application running on port 3000
    ProxyPreserveHost On
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
    
    # Enable WebSocket support for hot reload
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*)           ws://localhost:3000/$1 [P,L]
    RewriteCond %{HTTP:Upgrade} !=websocket [NC]
    RewriteRule /(.*)           http://localhost:3000/$1 [P,L]
    
    # Logging
    ErrorLog "logs/bettadayz-store-error.log"
    CustomLog "logs/bettadayz-store-access.log" common
    
    # Security headers
    Header always set X-Frame-Options "DENY"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "origin-when-cross-origin"
    
    # CORS headers for dual domain support
    Header always set Access-Control-Allow-Origin "http://bettadayz.shop, http://bettadayz.store"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
</VirtualHost>

# WWW subdomain redirect to non-www
<VirtualHost *:80>
    ServerName www.bettadayz.store
    ServerAdmin admin@bettadayz.store
    
    # Redirect all www traffic to non-www
    RewriteEngine On
    RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
    RewriteRule ^(.*)$ http://%1$1 [R=301,L]
    
    ErrorLog "logs/www-bettadayz-store-error.log"
    CustomLog "logs/www-bettadayz-store-access.log" common
</VirtualHost>

# ============================================================================
# ALTERNATIVE: STATIC BUILD SERVING (If not using Node.js proxy)
# ============================================================================
# Uncomment these virtual hosts if you want to serve static builds directly
# from Apache without Node.js proxy
# ============================================================================

# <VirtualHost *:80>
#     ServerName bettadayz.shop
#     ServerAlias www.bettadayz.shop
#     ServerAdmin admin@bettadayz.shop
#     
#     # Point to static build output
#     DocumentRoot "d:/bettadayzweb/xampp/htdocs/bettadayz"
#     
#     <Directory "d:/bettadayzweb/xampp/htdocs/bettadayz">
#         Options -Indexes +FollowSymLinks
#         AllowOverride All
#         Require all granted
#         
#         # SPA routing - redirect all requests to index.html
#         RewriteEngine On
#         RewriteBase /
#         RewriteRule ^index\.html$ - [L]
#         RewriteCond %{REQUEST_FILENAME} !-f
#         RewriteCond %{REQUEST_FILENAME} !-d
#         RewriteRule . /index.html [L]
#     </Directory>
#     
#     # Redirect www to non-www
#     RewriteEngine On
#     RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
#     RewriteRule ^(.*)$ http://%1$1 [R=301,L]
#     
#     # Logging
#     ErrorLog "logs/bettadayz-shop-error.log"
#     CustomLog "logs/bettadayz-shop-access.log" common
#     
#     # Security headers
#     Header always set X-Frame-Options "DENY"
#     Header always set X-Content-Type-Options "nosniff"
#     Header always set X-XSS-Protection "1; mode=block"
# </VirtualHost>
# 
# <VirtualHost *:80>
#     ServerName bettadayz.store
#     ServerAlias www.bettadayz.store
#     ServerAdmin admin@bettadayz.store
#     
#     # Point to static build output
#     DocumentRoot "d:/bettadayzweb/xampp/htdocs/bettadayz"
#     
#     <Directory "d:/bettadayzweb/xampp/htdocs/bettadayz">
#         Options -Indexes +FollowSymLinks
#         AllowOverride All
#         Require all granted
#         
#         # SPA routing - redirect all requests to index.html
#         RewriteEngine On
#         RewriteBase /
#         RewriteRule ^index\.html$ - [L]
#         RewriteCond %{REQUEST_FILENAME} !-f
#         RewriteCond %{REQUEST_FILENAME} !-d
#         RewriteRule . /index.html [L]
#     </Directory>
#     
#     # Redirect www to non-www
#     RewriteEngine On
#     RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
#     RewriteRule ^(.*)$ http://%1$1 [R=301,L]
#     
#     # Logging
#     ErrorLog "logs/bettadayz-store-error.log"
#     CustomLog "logs/bettadayz-store-access.log" common
#     
#     # Security headers
#     Header always set X-Frame-Options "DENY"
#     Header always set X-Content-Type-Options "nosniff"
#     Header always set X-XSS-Protection "1; mode=block"
# </VirtualHost>

# ============================================================================
# SSL/HTTPS CONFIGURATION (Optional)
# ============================================================================
# To enable HTTPS:
# 1. Generate self-signed certificate in d:\bettadayzweb\xampp\apache
# 2. Uncomment SSL configuration below
# 3. Enable SSL module in httpd.conf:
#    LoadModule ssl_module modules/mod_ssl.so
#    Include conf/extra/httpd-ssl.conf
# ============================================================================

# <VirtualHost *:443>
#     ServerName bettadayz.shop
#     ServerAdmin admin@bettadayz.shop
#     
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile "conf/ssl.crt/bettadayz.shop.crt"
#     SSLCertificateKeyFile "conf/ssl.key/bettadayz.shop.key"
#     
#     # Proxy to Node.js
#     ProxyPreserveHost On
#     ProxyPass / http://localhost:3000/
#     ProxyPassReverse / http://localhost:3000/
#     
#     # WebSocket support
#     RewriteEngine On
#     RewriteCond %{HTTP:Upgrade} =websocket [NC]
#     RewriteRule /(.*)           wss://localhost:3000/$1 [P,L]
#     
#     ErrorLog "logs/bettadayz-shop-ssl-error.log"
#     CustomLog "logs/bettadayz-shop-ssl-access.log" common
# </VirtualHost>
# 
# <VirtualHost *:443>
#     ServerName bettadayz.store
#     ServerAdmin admin@bettadayz.store
#     
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile "conf/ssl.crt/bettadayz.store.crt"
#     SSLCertificateKeyFile "conf/ssl.key/bettadayz.store.key"
#     
#     # Proxy to Node.js
#     ProxyPreserveHost On
#     ProxyPass / http://localhost:3000/
#     ProxyPassReverse / http://localhost:3000/
#     
#     # WebSocket support
#     RewriteEngine On
#     RewriteCond %{HTTP:Upgrade} =websocket [NC]
#     RewriteRule /(.*)           wss://localhost:3000/$1 [P,L]
#     
#     ErrorLog "logs/bettadayz-store-ssl-error.log"
#     CustomLog "logs/bettadayz-store-ssl-access.log" common
# </VirtualHost>

# ============================================================================
# NOTES AND TROUBLESHOOTING
# ============================================================================
#
# 1. Ensure Node.js application is running on port 3000:
#    cd d:\bettadayzweb\BettaDayzPBBG
#    npm run dev
#
# 2. If port 3000 is in use, change it in package.json or use:
#    npm run dev -- -p 3001
#    (Then update ProxyPass to use port 3001)
#
# 3. Required Apache modules (check httpd.conf):
#    - mod_proxy
#    - mod_proxy_http
#    - mod_proxy_wstunnel (for WebSocket)
#    - mod_rewrite
#    - mod_headers
#
# 4. To enable these modules, uncomment in httpd.conf:
#    LoadModule proxy_module modules/mod_proxy.so
#    LoadModule proxy_http_module modules/mod_proxy_http.so
#    LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so
#    LoadModule rewrite_module modules/mod_rewrite.so
#    LoadModule headers_module modules/mod_headers.so
#
# 5. Test Apache configuration:
#    d:\bettadayzweb\xampp\apache\bin\httpd.exe -t
#
# 6. View Apache error logs:
#    d:\bettadayzweb\xampp\apache\logs\error.log
#
# 7. Common issues:
#    - 502 Bad Gateway: Node.js not running or wrong port
#    - 404 Not Found: Check DocumentRoot path for static builds
#    - Access Denied: Check Directory permissions
#    - Domain not resolving: Check Windows hosts file
#
# 8. For production deployment, use the HOSTINGER-DEPLOYMENT-GUIDE.md
#    or DUAL-DOMAIN-DEPLOYMENT.md guides
#
# ============================================================================

# End of Virtual Hosts Configuration
